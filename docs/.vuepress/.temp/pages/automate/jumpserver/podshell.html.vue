<template><h2 id="二开-jumpserver-podshell-登录" tabindex="-1"><a class="header-anchor" href="#二开-jumpserver-podshell-登录" aria-hidden="true">#</a> 二开 jumpserver  podshell 登录</h2>
<p>目的： 控制开发人员可以登录的权限</p>
<p>版本： <strong>v2.19.2</strong></p>
<p>修改如下文件内容</p>
<div class="language-python ext-py line-numbers-mode"><pre v-pre class="language-python"><code>diff <span class="token operator">-</span>r old<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>api<span class="token operator">/</span>mixin<span class="token punctuation">.</span>py new<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>api<span class="token operator">/</span>mixin<span class="token punctuation">.</span>py
42c42
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">serialize_applications_with_org</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> applications<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>     <span class="token keyword">def</span> <span class="token function">serialize_applications_with_org</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> applications<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> user<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
84c84
<span class="token operator">&lt;</span>         tree_nodes <span class="token operator">=</span> KubernetesTree<span class="token punctuation">(</span>tree_id<span class="token punctuation">)</span><span class="token punctuation">.</span>async_tree_node<span class="token punctuation">(</span>parent_info<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>         tree_nodes <span class="token operator">=</span> KubernetesTree<span class="token punctuation">(</span>tree_id<span class="token punctuation">)</span><span class="token punctuation">.</span>async_tree_node<span class="token punctuation">(</span>parent_info<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span>

diff <span class="token operator">-</span>r old<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>utils<span class="token operator">/</span>kubernetes_util<span class="token punctuation">.</span>py new<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>applications<span class="token operator">/</span>utils<span class="token operator">/</span>kubernetes_util<span class="token punctuation">.</span>py
14a15<span class="token punctuation">,</span><span class="token number">16</span>
<span class="token operator">></span> <span class="token keyword">import</span> requests
<span class="token operator">></span> <span class="token keyword">import</span> json
<span class="token number">59</span><span class="token punctuation">,</span>60c61<span class="token punctuation">,</span><span class="token number">92</span>
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">get_pods</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">&lt;</span>         api <span class="token operator">=</span> self<span class="token punctuation">.</span>get_api<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>     <span class="token comment">#def get_pods(self):</span>
<span class="token operator">></span>     <span class="token comment">#    api = self.get_api()</span>
<span class="token operator">></span>     <span class="token comment">#    try:</span>
<span class="token operator">></span>     <span class="token comment">#        ret = api.list_pod_for_all_namespaces(watch=False, _request_timeout=(3, 3))</span>
<span class="token operator">></span>     <span class="token comment">#    except MaxRetryError:</span>
<span class="token operator">></span>     <span class="token comment">#        logger.warning('Kubernetes connection timed out')</span>
<span class="token operator">></span>     <span class="token comment">#        return</span>
<span class="token operator">></span>     <span class="token comment">#    except ApiException as e:</span>
<span class="token operator">></span>     <span class="token comment">#        if e.status == 401:</span>
<span class="token operator">></span>     <span class="token comment">#            logger.warning('Kubernetes User not authenticated')</span>
<span class="token operator">></span>     <span class="token comment">#        else:</span>
<span class="token operator">></span>     <span class="token comment">#            logger.warning(e)</span>
<span class="token operator">></span>     <span class="token comment">#        return</span>
<span class="token operator">></span>     <span class="token comment">#    data = {}</span>
<span class="token operator">></span>     <span class="token comment">#    for i in ret.items:</span>
<span class="token operator">></span>     <span class="token comment">#        namespace = i.metadata.namespace</span>
<span class="token operator">></span>     <span class="token comment">#        pod_info = {</span>
<span class="token operator">></span>     <span class="token comment">#            'pod_name': i.metadata.name,</span>
<span class="token operator">></span>     <span class="token comment">#            'containers': [j.name for j in i.spec.containers]</span>
<span class="token operator">></span>     <span class="token comment">#        }</span>
<span class="token operator">></span>     <span class="token comment">#        if namespace in data:</span>
<span class="token operator">></span>     <span class="token comment">#            data[namespace].append(pod_info)</span>
<span class="token operator">></span>     <span class="token comment">#        else:</span>
<span class="token operator">></span>     <span class="token comment">#            data[namespace] = [pod_info, ]</span>
<span class="token operator">></span>     <span class="token comment">#    return data</span>
<span class="token operator">></span>     <span class="token keyword">def</span> <span class="token function">get_pods</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">></span>         <span class="token comment"># 调用 外部系统，查看 用户具有 appid 的权限列表</span>
<span class="token operator">></span>         xxx_api <span class="token operator">=</span> <span class="token string">"https://xxx/xxx_api/v1/auth/user/"</span>
<span class="token operator">></span>         xxx_auth <span class="token operator">=</span> <span class="token string">"xxx"</span>
<span class="token operator">></span>
<span class="token operator">></span>         res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>xxx_api<span class="token operator">+</span>login_username<span class="token operator">+</span><span class="token string">"/appid"</span><span class="token punctuation">,</span> headers<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"Authorization"</span><span class="token punctuation">:</span> xxx_auth<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">></span>         xxx_apps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token number">62</span><span class="token punctuation">,</span>64c94<span class="token punctuation">,</span><span class="token number">102</span>
<span class="token operator">&lt;</span>             ret <span class="token operator">=</span> api<span class="token punctuation">.</span>list_pod_for_all_namespaces<span class="token punctuation">(</span>watch<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> _request_timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>         <span class="token keyword">except</span> MaxRetryError<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>             logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Kubernetes connection timed out'</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>             body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token operator">></span>             data <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>
<span class="token operator">></span>             msg <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span>
<span class="token operator">></span>             code <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"code"</span><span class="token punctuation">]</span>
<span class="token operator">></span>             <span class="token keyword">if</span> code <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token operator">></span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用 xxx 返回异常"</span><span class="token punctuation">)</span>
<span class="token operator">></span>                 <span class="token keyword">return</span>
<span class="token operator">></span>         <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">></span>             <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用 xxx 获取appid列表解析失败:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">66</span><span class="token punctuation">,</span>70c104<span class="token punctuation">,</span><span class="token number">118</span>
<span class="token operator">&lt;</span>         <span class="token keyword">except</span> ApiException <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>             <span class="token keyword">if</span> e<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">:</span>
<span class="token operator">&lt;</span>                 logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">'Kubernetes User not authenticated'</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span>             <span class="token keyword">else</span><span class="token punctuation">:</span>
<span class="token operator">&lt;</span>                 logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>         <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token operator">></span>             res<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">></span>         <span class="token keyword">for</span> app <span class="token keyword">in</span> data<span class="token punctuation">:</span>
<span class="token operator">></span>             xxx_apps<span class="token punctuation">.</span>append<span class="token punctuation">(</span>app<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">></span>
<span class="token operator">></span>         <span class="token comment"># 调用k8s-resource-apis, 自封装的 api 接口</span>
<span class="token operator">></span>         res_apps <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">></span>         k8s_resource_api <span class="token operator">=</span> <span class="token string">"http://xxxx"</span>
<span class="token operator">></span>         res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k8s_resource_api<span class="token operator">+</span><span class="token string">"/get-all-app-list/"</span><span class="token punctuation">)</span>
<span class="token operator">></span>         <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token operator">></span>             body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token operator">></span>             data <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>
<span class="token operator">></span>             msg <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"msg"</span><span class="token punctuation">]</span>
<span class="token operator">></span>         <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">></span>             <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用k8sResourceApi获取appid列表解析失败:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">72</span><span class="token punctuation">,</span>80c120<span class="token punctuation">,</span><span class="token number">157</span>
<span class="token operator">&lt;</span>         data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token operator">&lt;</span>         <span class="token keyword">for</span> i <span class="token keyword">in</span> ret<span class="token punctuation">.</span>items<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>             namespace <span class="token operator">=</span> i<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>namespace
<span class="token operator">&lt;</span>             pod_info <span class="token operator">=</span> <span class="token punctuation">{</span>
<span class="token operator">&lt;</span>                 <span class="token string">'pod_name'</span><span class="token punctuation">:</span> i<span class="token punctuation">.</span>metadata<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
<span class="token operator">&lt;</span>                 <span class="token string">'containers'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>j<span class="token punctuation">.</span>name <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>containers<span class="token punctuation">]</span>
<span class="token operator">&lt;</span>             <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>             <span class="token keyword">if</span> namespace <span class="token keyword">in</span> data<span class="token punctuation">:</span>
<span class="token operator">&lt;</span>                 data<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>pod_info<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>         <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token operator">></span>             res<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">></span>
<span class="token operator">></span>         <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token operator">></span>             <span class="token keyword">for</span> item <span class="token keyword">in</span> data<span class="token punctuation">:</span>
<span class="token operator">></span>                 res_apps<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token operator">></span>
<span class="token operator">></span>         <span class="token comment"># apps</span>
<span class="token operator">></span>         apps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">></span>         <span class="token keyword">for</span> item <span class="token keyword">in</span> xxx_apps<span class="token punctuation">:</span>
<span class="token operator">></span>             <span class="token keyword">if</span> item <span class="token keyword">in</span> res_apps<span class="token punctuation">:</span>
<span class="token operator">></span>                 apps<span class="token punctuation">.</span>append<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
<span class="token operator">></span>
<span class="token operator">></span>         <span class="token comment"># get pods</span>
<span class="token operator">></span>         ctx <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>    <span class="token comment"># {"namespace": [{podname:aaaa, containers}]}</span>
<span class="token operator">></span>         <span class="token keyword">for</span> appid <span class="token keyword">in</span> apps<span class="token punctuation">:</span>
<span class="token operator">></span>             res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k8s_resource_api<span class="token operator">+</span><span class="token string">"/get-pods-by-app/"</span><span class="token operator">+</span>appid<span class="token operator">+</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token operator">></span>             <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token operator">></span>                 body <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
<span class="token operator">></span>                 data <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"data"</span><span class="token punctuation">]</span>
<span class="token operator">></span>                 msg <span class="token operator">=</span> body<span class="token punctuation">[</span><span class="token string">"msg"</span><span class="token punctuation">]</span>
<span class="token operator">></span>             <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">></span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用k8sResourceApis获取appid-pods列表解析失败:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">,</span> appid<span class="token punctuation">)</span>
<span class="token operator">></span>             <span class="token keyword">finally</span><span class="token punctuation">:</span>
<span class="token operator">></span>                 res<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">></span>
<span class="token operator">></span>             <span class="token keyword">if</span> res<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
<span class="token operator">></span>                 <span class="token keyword">try</span><span class="token punctuation">:</span>
<span class="token operator">></span>                     <span class="token keyword">for</span> pod <span class="token keyword">in</span> data<span class="token punctuation">:</span>            <span class="token comment"># key: pod-name, 原始data结构：{"pod-name": {"Ns": "xxx", "Containers": {"c-name": "c-id"}}}</span>
<span class="token operator">></span>                         ns <span class="token operator">=</span> data<span class="token punctuation">[</span>pod<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"Ns"</span><span class="token punctuation">]</span>    <span class="token comment"># ns == "xxx"</span>
<span class="token operator">></span>                         <span class="token keyword">if</span> ns <span class="token keyword">not</span> <span class="token keyword">in</span> ctx<span class="token punctuation">:</span>
<span class="token operator">></span>                             ctx<span class="token punctuation">[</span>ns<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">></span>                         containers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token operator">></span>                         <span class="token keyword">for</span> c <span class="token keyword">in</span> data<span class="token punctuation">[</span>pod<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"Containers"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
<span class="token operator">></span>                             containers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token operator">></span>                         ctx<span class="token punctuation">[</span>ns<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">"pod_name"</span><span class="token punctuation">:</span> pod<span class="token punctuation">,</span> <span class="token string">"containers"</span><span class="token punctuation">:</span> containers<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">></span>                 <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
<span class="token operator">></span>                     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"解析重组pod列表信息异常:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">82</span><span class="token punctuation">,</span>83c159<span class="token punctuation">,</span><span class="token number">160</span>
<span class="token operator">&lt;</span>                 data<span class="token punctuation">[</span>namespace<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>pod_info<span class="token punctuation">,</span> <span class="token punctuation">]</span>
<span class="token operator">&lt;</span>         <span class="token keyword">return</span> data
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>                 <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"调用k8sResourceApis获取pod列表返回状态异常:"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" "</span><span class="token operator">+</span>msg<span class="token punctuation">)</span>
<span class="token operator">></span>         <span class="token keyword">return</span> ctx
86c163
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">get_kubernetes_data</span><span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>     <span class="token keyword">def</span> <span class="token function">get_kubernetes_data</span><span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
91c168
<span class="token operator">&lt;</span>         <span class="token keyword">return</span> k8s<span class="token punctuation">.</span>get_pods<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>         <span class="token keyword">return</span> k8s<span class="token punctuation">.</span>get_pods<span class="token punctuation">(</span>login_username<span class="token punctuation">)</span>
153c230
<span class="token operator">&lt;</span>     <span class="token keyword">def</span> <span class="token function">async_tree_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>     <span class="token keyword">def</span> <span class="token function">async_tree_node</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span><span class="token punctuation">:</span>
160c237
<span class="token operator">&lt;</span>         data <span class="token operator">=</span> KubernetesClient<span class="token punctuation">.</span>get_kubernetes_data<span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>         data <span class="token operator">=</span> KubernetesClient<span class="token punctuation">.</span>get_kubernetes_data<span class="token punctuation">(</span>app_id<span class="token punctuation">,</span> system_user_id<span class="token punctuation">,</span> login_username<span class="token punctuation">)</span>

diff <span class="token operator">-</span>r old<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>perms<span class="token operator">/</span>api<span class="token operator">/</span>application<span class="token operator">/</span>user_permission<span class="token operator">/</span>user_permission_applications<span class="token punctuation">.</span>py new<span class="token operator">-</span>apps<span class="token operator">/</span>apps<span class="token operator">/</span>perms<span class="token operator">/</span>api<span class="token operator">/</span>application<span class="token operator">/</span>user_permission<span class="token operator">/</span>user_permission_applications<span class="token punctuation">.</span>py
59a60<span class="token punctuation">,</span><span class="token number">64</span>
<span class="token operator">></span>         login_username <span class="token operator">=</span> <span class="token string">""</span>
<span class="token operator">></span>         login_user <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>__dict__<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"_user"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">></span>         lft <span class="token operator">=</span> login_user<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'('</span><span class="token punctuation">)</span>
<span class="token operator">></span>         <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>lft<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
<span class="token operator">></span>            login_username <span class="token operator">=</span> lft<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">')'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
64c69
<span class="token operator">&lt;</span>             queryset<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
<span class="token operator">></span>             queryset<span class="token punctuation">,</span> tree_id<span class="token punctuation">,</span> parent_info<span class="token punctuation">,</span> self<span class="token punctuation">.</span>user<span class="token punctuation">,</span> login_username
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br></div></div></template>
